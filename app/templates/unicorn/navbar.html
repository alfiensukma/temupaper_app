<nav class="sticky top-0 z-50 bg-white shadow-sm">
    <div class="container flex flex-wrap items-center justify-between px-6 py-3 mx-auto md:px-10 lg:px-16">

        <a href="/" class="flex items-center space-x-2 rtl:space-x-reverse" unicorn:click="navigate('home', 'search-paper/index.html')">
            <div class="self-center text-2xl md:text-3xl font-bold font-jakarta text-black">
                <span>Tem<span class="text-[#4787FA]">uP</span>aper</span>
            </div>
        </a>

        <div x-data="{ 
            init() {
                let storedQuery = localStorage.getItem('searchQuery') || '';
                $wire.set('search_query', storedQuery);
            }
        }" class="order-3 w-full mt-3 md:order-2 md:mt-0 md:w-auto md:flex-1 md:mx-4 lg:mx-8">
            {% if show_search_form %}
            <form action="{% url 'search' %}" method="GET" class="w-full max-w-[600px] mx-auto">
                <div class="relative">
                    <input 
                        type="search" 
                        name="query"
                        x-init="$el.value = localStorage.getItem('searchQuery') || ''"
                        @input="localStorage.setItem('searchQuery', $event.target.value)"
                        unicorn:model.defer="search_query"
                        class="w-full p-2 ps-4 pe-24 text-sm md:text-base font-medium text-gray-900 rounded-lg bg-[#f4f4f4] outline-none transition-all duration-200 focus:ring-2 focus:ring-[#4787FA] focus:ring-opacity-50" 
                        placeholder="Cari judul, kata kunci, atau lainnya..." 
                        autocomplete="off" 
                        required 
                    />
                    <button type="submit" class="flex items-center gap-1 text-white absolute end-1 top-1/2 -translate-y-1/2 bg-[#4787FA] hover:bg-blue-600 transition-colors duration-200 focus:ring-2 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-3 py-1.5">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="... (icon path)" fill="white"/>
                        </svg>
                        <span class="hidden sm:inline">Cari</span>
                    </button>
                </div>
            </form>
            {% endif %}
        </div>

        <button id="mobile-menu-button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" onclick="document.getElementById('navbar-menu').classList.toggle('hidden')">
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
            </svg>
        </button>

        <div class="hidden w-full md:block md:w-auto md:order-3" id="navbar-menu">
            <ul class="flex flex-col py-3 font-medium md:flex-row md:space-x-4 lg:space-x-6 md:py-0 md:items-center">
                <li>
                    <a href="/" unicorn:click="navigate('home', 'search-paper/index.html')"
                        class="block py-2 px-3 text-sm md:text-base rounded-sm md:bg-transparent 
                        {% if request.path != '/' %}text-[#A6A6A6] hover:text-[#4787FA] {% else %}text-[#4787FA] hover:text-blue-600 {% endif %}
                        md:p-0" aria-current="page">Home</a>
                </li>
                <li class="relative">
                    <button unicorn:click="toggle_dropdown"
                        class="flex items-center justify-between w-full py-2 px-3 text-sm md:text-base rounded-md
                        {% if current_path in active_paths or is_dropdown_open %}
                            text-[#4787FA] hover:text-blue-600
                        {% else %}
                            text-[#A6A6A6] hover:text-[#4787FA] 
                        {% endif %}
                        ">
                        Rekomendasi
                        <svg class="w-3 h-3 ml-1" fill="none" viewBox="0 0 20 20" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div class="{% if is_dropdown_open %}block{% else %}hidden{% endif %} absolute z-50 mt-1 w-40 bg-white rounded-md shadow-lg border border-gray-100">
                        <ul class="py-1 text-sm text-gray-700 font-normal">
                            {% for item in dropdown_items %}
                            <li>
                                <a href="{{ item.url }}" unicorn:click="navigate('{{ item.name|lower }}', '{{ item.template }}')"
                                   class="block px-4 py-2 hover:bg-[#4787FA] hover:text-white transition-colors duration-150">
                                    {{ item.name }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>

                {% if user.is_authenticated %}
                <li class="relative mt-2 md:mt-0">
                    <button onclick="document.getElementById('user-dropdown').classList.toggle('hidden')" 
                            class="flex items-center space-x-2 text-sm md:text-base font-medium text-gray-700 hover:text-[#4787FA] focus:outline-none">
                        <img src="/static/images/user-icon.png" alt="User" class="w-6 h-6 rounded-full object-cover" />
                        <span>{{ user.first_name }}</span>
                        <svg class="w-3 h-3 ml-1" fill="none" viewBox="0 0 20 20" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="user-dropdown" class="hidden absolute right-0 z-50 mt-1 w-48 bg-white rounded-md shadow-lg border border-gray-100">
                        <ul class="py-1 text-sm text-gray-700 font-normal">
                            <li><a href="{% url 'profile_view' %}" class="block px-4 py-2 hover:bg-[#4787FA] hover:text-white">Profile</a></li>
                            <li><a href="{% url 'profile_view' %}" class="block px-4 py-2 hover:bg-[#4787FA] hover:text-white">Simpan Karya Ilmiah</a></li>
                            <li><a href="{% url 'logout' %}" class="block px-4 py-2 hover:bg-red-100 text-red-600">Logout</a></li>
                        </ul>
                    </div>
                </li>
                {% else %}
                <li class="mt-2 md:mt-0 flex flex-col md:flex-row md:items-center gap-2 md:gap-3">
                    <a href="/login" class="inline-block text-white bg-[#4787FA] hover:bg-blue-600 transition-colors duration-200 focus:ring-2 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm px-4 py-1.5 text-center w-full md:w-auto">Masuk</a>
                    <a href="/register" class="inline-block text-[#4787FA] border border-[#4787FA] bg-transparent hover:bg-blue-50 transition-colors duration-200 focus:ring-2 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm px-4 py-1.5 text-center w-full md:w-auto">Daftar</a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>

    <script>
    document.addEventListener('click', function (e) {
        const dropdown = document.getElementById('user-dropdown');
        if (!dropdown) return;
        const button = e.target.closest('button');
        if (!dropdown.contains(e.target) && !button?.contains(e.target)) {
            dropdown.classList.add('hidden');
        }
    });
    </script>
</nav>